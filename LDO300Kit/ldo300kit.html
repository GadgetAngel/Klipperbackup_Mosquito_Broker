<!doctype html>
<html>
<title>LDO 300 kit Control Page</title>
<head>
  <meta name="viewport" content="initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="jquery.mobile-1.4.0.css" />
   <script src= "jquery.min.js" type="text/javascript" ></script>
  <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
  <script src="http://code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.js"></script>
  <script src= "mqttws31.js" type="text/javascript" ></script>
  <script type = "text/javascript" language = "javascript">
        
     var mqtt_SHUTDOWN;
     var mqtt_Raspberry_Pi_PSU;  //Turn OFF Raspberry Pi PSU
     var mqtt_BOOT;
     var mqtt_Raspberry_Pi_PSU2; //Turn on Raspberry Pi PSU
     var mqtt_ESP1_PSU;
     var mqtt_ESP2_PSU;
     var mqtt_IR_PSU;
     var mqtt_RGB_PSU;
     var mqtt_RGB2_PSU;
        
     const myInit = {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
        },
        mode: 'cors',
        cache: 'no-cache',
        credentials: 'same-origin'
     };
     var data;
     var url1 = 'http://192.168.1.172:86/user1.JSON';
     var url2 = 'http://192.168.1.172:86/user2.JSON';
     var url3 = 'http://192.168.1.172:86/user3.JSON';
     var url4 = 'http://192.168.1.172:86/user4.JSON';
     var url5 = 'http://192.168.1.172:86/user5.JSON';
     var url6 = 'http://192.168.1.172:86/user6.JSON';
     var url7 = 'http://192.168.1.172:86/user7.JSON';
        
     var reconnectTimeout = 2000;
     var host="192.168.1.172"; //change this
     var port=9001;
            
     function onMessageArrived(msg) {
        out_msg="Message received "+msg.payloadSring+"<br>";
        out_msg=out_msg+"Message received Topic "+msg.destinationName;
        console.log(out_msg);
    }
    
    // Klipper SHUTDOWN macro!
    function onConnect_SHUTDOWN() {
       // Once a connection has been made, make a subscription and send a message.
       console.log("Connected ");
       message_SHUTDOWN = new Paho.MQTT.Message('{"jsonrpc": "2.0","method": "printer.gcode.script","params": {"script": "SHUTDOWN"},"id": 507466}');
       message_SHUTDOWN.destinationName = "printer/ldo300kit/moonraker/api/request";
       mqtt_SHUTDOWN.send(message_SHUTDOWN);
    }
    function onFailure_SHUTDOWN(messag) {
       console.log("Connected Attempt to Host "+host+" Failed");
       setTimeout(MQTTconnect_SHUTDOWN, reconnectTimeout);
    }
    function MQTTconnect_SHUTDOWN() {
       console.log("connecting to "+ host +" "+ port);
       mqtt_SHUTDOWN = new Paho.MQTT.Client(host,port,"SHUTDOWN");
       fetch(url1, myInit)
           .then(response => response.json())
           .then(json => {
                var options = {
                    //useSSL:true,
                    timeout: 3,
                    userName: json.user_name,
                    password: json.password,
                    onSuccess: onConnect_SHUTDOWN,
                    onFailure: onFailure_SHUTDOWN,
                };
                mqtt_SHUTDOWN.onMessageArrived = onMessageArrived;
                mqtt_SHUTDOWN.connect(options); //connect
            })
            .catch((error) => {
                console.error('Error:', error);
            });      
    } 
    
    // Tasmota firmware - Turn OFF Raspberry_Pi_PSU
    function onConnect_Raspberry_Pi_PSU() {
        // Once a connection has been made, make a subscription and send a message.
        console.log("Connected ");
        message_Raspberry_Pi_PSU = new Paho.MQTT.Message("OFF");
        message_Raspberry_Pi_PSU.destinationName = "cmnd/Raspberry_Pi/Power";
        mqtt_Raspberry_Pi_PSU.send(message_Raspberry_Pi_PSU);
    }
    function onFailure_Raspberry_Pi_PSU(messag) {
        console.log("Connected Attempt to Host "+host+" Failed");
        setTimeout(MQTTconnect_Raspberry_Pi_PSU, reconnectTimeout);
    }
    function MQTTconnect_Raspberry_Pi_PSU() {
        console.log("connecting to "+ host +" "+ port);
        mqtt_Raspberry_Pi_PSU = new Paho.MQTT.Client(host,port,"Raspberry_Pi");
        fetch(url2, myInit)
           .then(response => response.json())
           .then(json => {
                var options = {
                    //useSSL:true,
                    timeout: 3,
                    userName: json.user_name,
                    password: json.password,
                    onSuccess: onConnect_Raspberry_Pi_PSU,
                    onFailure: onFailure_Raspberry_Pi_PSU,
                };
                mqtt_Raspberry_Pi_PSU.onMessageArrived = onMessageArrived;
                mqtt_Raspberry_Pi_PSU.connect(options); //connect
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    }
        
    // Klipper BOOT macro!
    function onConnect_BOOT() {
        // Once a connection has been made, make a subscription and send a message.
        console.log("Connected ");
        mqtt_BOOT.subscribe("printer/ldo300kit/moonraker/api/response");
        message_BOOT = new Paho.MQTT.Message('{"jsonrpc": "2.0","method": "printer.gcode.script","params": {"script": "BOOT"},"id": 607466}');
        message_BOOT.destinationName = "printer/ldo300kit/moonraker/api/request";
        mqtt_BOOT.send(message_BOOT);
    }
    function onFailure_BOOT(messag) {
        console.log("Connected Attempt to Host "+host+" Failed");
        setTimeout(MQTTconnect_BOOT, reconnectTimeout);
    }
    function MQTTconnect_BOOT() {
        console.log("connecting to "+ host +" "+ port);
        mqtt_BOOT = new Paho.MQTT.Client(host,port,"BOOT");
        fetch(url1, myInit)
           .then(response => response.json())
           .then(json => {
                var options = {
                    //useSSL:true,
                    timeout: 3,
                    userName: json.user_name,
                    password: json.password,
                    onSuccess: onConnect_BOOT,
                    onFailure: onFailure_BOOT,
                };
                mqtt_BOOT.onMessageArrived = onMessageArrived;
                mqtt_BOOT.connect(options); //connect
            })
            .catch((error) => {
                console.error('Error:', error);
            });      
    }
    
    // Tasmota firmware - Turn ON Raspberry_Pi_PSU
    function onConnect_Raspberry_Pi_PSU2() {
        // Once a connection has been made, make a subscription and send a message.
        console.log("Connected ");
        mqtt_Raspberry_Pi_PSU2.subscribe("stat/Raspberry_Pi/Power");
        message_Raspberry_Pi_PSU2 = new Paho.MQTT.Message("ON");
        message_Raspberry_Pi_PSU2.destinationName = "cmnd/Raspberry_Pi/Power";
        mqtt_Raspberry_Pi_PSU2.send(message_Raspberry_Pi_PSU2);
    }
    function onFailure_Raspberry_Pi_PSU2(messag) {
        console.log("Connected Attempt to Host "+host+" Failed");
        setTimeout(MQTTconnect_Raspberry_Pi_PSU2, reconnectTimeout);
    }
    function MQTTconnect_Raspberry_Pi_PSU2() {
        console.log("connecting to "+ host +" "+ port);
        mqtt_Raspberry_Pi_PSU2 = new Paho.MQTT.Client(host,port,"Raspberry_Pi");
        fetch(url2, myInit)
           .then(response => response.json())
           .then(json => {
                var options = {
                    //useSSL:true,
                    timeout: 3,
                    userName: json.user_name,
                    password: json.password,
                    onSuccess: onConnect_Raspberry_Pi_PSU2,
                    onFailure: onFailure_Raspberry_Pi_PSU2,
                };
                mqtt_Raspberry_Pi_PSU2.onMessageArrived = onMessageArrived;
                mqtt_Raspberry_Pi_PSU2.connect(options); //connect
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    }
     
    // Tasmota firmware - Turn ON ESP1_PSU
    function onConnect_ESP1_PSU() {
        // Once a connection has been made, make a subscription and send a message.
        console.log("Connected ");
        mqtt_ESP1_PSU.subscribe("stat/ESP1_PSU/Power");
        message_ESP1_PSU = new Paho.MQTT.Message("ON");
        message_ESP1_PSU.destinationName = "cmnd/ESP1_PSU/Power";
        mqtt_ESP1_PSU.send(message_ESP1_PSU);
    }
    function onFailure_ESP1_PSU(messag) {
        console.log("Connected Attempt to Host "+host+" Failed");
        setTimeout(MQTTconnect_ESP1_PSU, reconnectTimeout);
    }
    function MQTTconnect_ESP1_PSU() {
        console.log("connecting to "+ host +" "+ port);
        mqtt_ESP1_PSU = new Paho.MQTT.Client(host,port,"ESP1_PSU");
        fetch(url3, myInit)
           .then(response => response.json())
           .then(json => {
                var options = {
                    //useSSL:true,
                    timeout: 3,
                    userName: json.user_name,
                    password: json.password,
                    onSuccess: onConnect_ESP1_PSU,
                    onFailure: onFailure_ESP1_PSU,
                };
                mqtt_ESP1_PSU.onMessageArrived = onMessageArrived;
                mqtt_ESP1_PSU.connect(options); //connect
            })
           .catch((error) => {
              console.error('Error:', error);
            });
    }
          
    // Tasmota firmware - Turn ON _ESP2_PSU
    function onConnect_ESP2_PSU() {
        // Once a connection has been made, make a subscription and send a message.
        console.log("Connected ");
        mqtt_ESP2_PSU.subscribe("stat/ESP2_PSU/Power");
        message_ESP2_PSU = new Paho.MQTT.Message("ON");
        message_ESP2_PSU.destinationName = "cmnd/ESP2_PSU/Power";
        mqtt_ESP2_PSU.send(message_ESP2_PSU);
    }
    function onFailure_ESP2_PSU(messag) {
        console.log("Connected Attempt to Host "+host+" Failed");
        setTimeout(MQTTconnect_ESP2_PSU, reconnectTimeout);
    }
    function MQTTconnect_ESP2_PSU() {
         console.log("connecting to "+ host +" "+ port);
         mqtt_ESP2_PSU = new Paho.MQTT.Client(host,port,"ESP2_PSU");
         fetch(url4, myInit)
           .then(response => response.json())
           .then(json => {
                 var options = {
                    //useSSL:true,
                    timeout: 3,
                    userName: json.user_name,
                    password: json.password,
                    onSuccess: onConnect_ESP2_PSU,
                    onFailure: onFailure_ESP2_PSU,
                };
                mqtt_ESP2_PSU.onMessageArrived = onMessageArrived;
                mqtt_ESP2_PSU.connect(options); //connect
            })
           .catch((error) => {
              console.error('Error:', error);
           });      
    } 

    // Tasmota firmware - Turn ON _IR_PSU
    function onConnect_IR_PSU() {
        // Once a connection has been made, make a subscription and send a message.
        console.log("Connected ");
        mqtt_IR_PSU.subscribe("stat/IR_PSU/Power");
        message_IR_PSU = new Paho.MQTT.Message("ON");
        message_IR_PSU.destinationName = "cmnd/IR_PSU/Power";
        mqtt_IR_PSU.send(message_IR_PSU);
    }
    function onFailure_IR_PSU(messag) {
        console.log("Connected Attempt to Host "+host+" Failed");
        setTimeout(MQTTconnect_IR_PSU, reconnectTimeout);
    }
    function MQTTconnect_IR_PSU() {
        console.log("connecting to "+ host +" "+ port);
        mqtt_IR_PSU = new Paho.MQTT.Client(host,port,"IR_PSU");
        fetch(url5, myInit)
           .then(response => response.json())
           .then(json => {
                var options = {
                    //useSSL:true,
                    timeout: 3,
                    userName: json.user_name,
                    password: json.password,
                    onSuccess: onConnect_IR_PSU,
                    onFailure: onFailure_IR_PSU,
                };
                mqtt_IR_PSU.onMessageArrived = onMessageArrived;
                mqtt_IR_PSU.connect(options); //connect
            })
           .catch((error) => {
              console.error('Error:', error);
            });           
    } 

    // Tasmota firmware - Turn ON _RGB_PSU
    function onConnect_RGB_PSU() {
        // Once a connection has been made, make a subscription and send a message.
        console.log("Connected ");
        mqtt_RGB_PSU.subscribe("stat/WLED1_15Amp_PSU/Power");
        message_RGB_PSU = new Paho.MQTT.Message("ON");
        message_RGB_PSU.destinationName = "cmnd/WLED1_15Amp_PSU/Power";
        mqtt_RGB_PSU.send(message_RGB_PSU);
    }
    function onFailure_RGB_PSU(messag) {
        console.log("Connected Attempt to Host "+host+" Failed");
        setTimeout(MQTTconnect_RGB_PSU, reconnectTimeout);
    }
    function MQTTconnect_RGB_PSU() {
        console.log("connecting to "+ host +" "+ port);
        mqtt_RGB_PSU = new Paho.MQTT.Client(host,port,"WLED1_15Amp_PSU");
        fetch(url6, myInit)
           .then(response => response.json())
           .then(json => {
                var options = {
                    //useSSL:true,
                    timeout: 3,
                    userName: json.user_name,
                    password: json.password,
                    onSuccess: onConnect_RGB_PSU,
                    onFailure: onFailure_RGB_PSU,
                };
                mqtt_RGB_PSU.onMessageArrived = onMessageArrived;
                mqtt_RGB_PSU.connect(options); //connect
            })
            .catch((error) => {
              console.error('Error:', error);
            });   
    } 

    // Tasmota firmware - Turn ON _RGB2
    function onConnect_RGB2_PSU() {
        // Once a connection has been made, make a subscription and send a message.
        console.log("Connected ");
        mqtt_RGB2_PSU.subscribe("stat/WLED2_10Amp_PSU/Power");
        message_RGB2_PSU = new Paho.MQTT.Message("ON");
        message_RGB2_PSU.destinationName = "cmnd/WLED2_10Amp_PSU/Power";
        mqtt_RGB2_PSU.send(message_RGB2_PSU);
    }
    function onFailure_RGB2_PSU(messag) {
        console.log("Connected Attempt to Host "+host+" Failed");
        setTimeout(MQTTconnect_RGB2_PSU, reconnectTimeout);
    }
    function MQTTconnect_RGB2_PSU() {
        console.log("connecting to "+ host +" "+ port);
        mqtt_RGB2_PSU = new Paho.MQTT.Client(host,port,"WLED2_10Amp_PSU");
        fetch(url7, myInit)
           .then(response => response.json())
           .then(json => {
                var options = {
                    //useSSL:true,
                    timeout: 3,
                    userName: json.user_name,
                    password: json.password,
                    onSuccess: onConnect_RGB2_PSU,
                    onFailure: onFailure_RGB2_PSU,
                };
                mqtt_RGB2_PSU.onMessageArrived = onMessageArrived;
                mqtt_RGB2_PSU.connect(options); //connect
            })
           .catch((error) => {
              console.error('Error:', error);
            });        
    }      
      </script>
    
</head>

<style>
  h1, h4 {text-align: center;}
  h3 {text-align: center;}
  span {font-weight: bold;}
  table, th, td {
  border: 5px solid white;
  border-collapse: collapse;}
  .bold { font-weight: bold; }
  .red { color: #FF0000; }
  .blck { color: #1B2631; }
  .yellow-background { background-color: Yellow; }​
</style>

<!-- perform the following commands after you make changes to this file:  -->
<!-- sudo nginx -t && sudo service php7.4-fpm restart && sudo service nginx restart -->
<!-- ./git_backup.sh -->

<body>

<script type="text/javascript">

  var mainsail_btn_Window;
  var fluidd_btn_Window;
  
  <!-- add addition web links below -->
  $(document).ready(function(){
     WARN.style.display = 'none';
  });
  $(document).ready(function(){
     $("#jschuh-btn").click(function(){
        window.open('https://github.com/jschuh/klipper-macros', '_blank');
      });
  });
  $(document).ready(function(){
     $("#AndrewEllis93-btn").click(function(){
        window.open('https://github.com/AndrewEllis93/v2.247_backup_klipper_config', '_blank');
      });
  });
  $(document).ready(function(){
     $("#pushc6-btn").click(function(){
        window.open('https://github.com/pushc6/VoronConfig', '_blank');
      });
  });
  $(document).ready(function(){
     $("#3dp-voron2-btn").click(function(){
        window.open('https://github.com/kageurufu/3dp-voron2/tree/master/printer', '_blank');
      });
  });
  $(document).ready(function(){
     $("#wile-e1-btn").click(function(){
        window.open('https://github.com/wile-e1/klipper_config', '_blank');
      });
  });
  $(document).ready(function(){
     $("#th33xitus-btn").click(function(){
        window.open('https://github.com/th33xitus/klipper_config', '_blank');
      });
  });
  $(document).ready(function(){
     $("#jktightwad-btn").click(function(){
        window.open('https://github.com/jktightwad/Klipper24Config', '_blank');
      });
  });
  $(document).ready(function(){
     $("#mjoconr-btn").click(function(){
        window.open('https://github.com/mjoconr/Voron2.4-Config', '_blank');
      });
  });
  $(document).ready(function(){
     $("#zellneralex-btn").click(function(){
        window.open('https://github.com/zellneralex/klipper_config', '_blank');
      });
  });
  $(document).ready(function(){
     $("#template-engine-btn").click(function(){
        window.open('https://jinja.palletsprojects.com/en/3.1.x/templates/', '_blank');
      });
  });
  $(document).ready(function(){
     $("#math-functions-btn").click(function(){
        window.open('https://jinja.palletsprojects.com/en/2.10.x/templates/#math', '_blank');
      });
  });
  $(document).ready(function(){
     $("#string-formatting-btn").click(function(){
        window.open('https://realpython.com/python-modulo-string-formatting/', '_blank');
      });
  });
  $(document).ready(function(){
     $("#basic-syntax-btn").click(function(){
        window.open('https://documentation.bloomreach.com/engagement/docs/jinja-syntax', '_blank');
      });
  });
  $(document).ready(function(){
     $("#command-templates-btn").click(function(){
        window.open('https://www.klipper3d.org/Command_Templates.html', '_blank');
      });
  });
  $(document).ready(function(){
     $("#generic-klipper-config-btn").click(function(){
        window.open('https://github.com/Frix-x/klipper-voron-V2', '_blank');
      });
  });
  $(document).ready(function(){
     $("#print-tuning-guide-btn").click(function(){
        window.open('https://ellis3dp.com/Print-Tuning-Guide/', '_blank');
      });
  });
  $(document).ready(function(){
     $("#voron-printer-database-btn").click(function(){
        window.open('https://dev.vorondb.com/', '_blank');
      });
  });
  $(document).ready(function(){
     $("#vorondesign-mods-btn").click(function(){
        window.open('https://mods.vorondesign.com/', '_blank');
      });
  });
  $(document).ready(function(){
     $("#vorondesign-forum-btn").click(function(){
        window.open('https://forum.vorondesign.com', '_blank');
      });
  });
  $(document).ready(function(){
     $("#reprap-g-code-docs-btn").click(function(){
        window.open('https://reprap.org/wiki/G-code', '_blank');
      });
  });
  $(document).ready(function(){
     $("#klipper-docs-btn").click(function(){
        window.open('https://www.klipper3d.org/Config_Reference.html', '_blank');
      });
  });
  $(document).ready(function(){
     $("#moontest-btn").click(function(){
        window.open('http://192.168.1.154:7992/moontest.html', '_blank');
      });
  });

  $(document).ready(function(){
     $("#mainssil-btn").click(function(){
        mainsail_btn_Window = window.open('http://192.168.1.154:7991', '_blank');
      });
  });

  $(document).ready(function(){
     $("#fluidd-btn").click(function(){
        fluidd_btn_Window = window.open('http://192.168.1.154:80', '_blank');
      });
  });

  $(document).ready(function(){
     $("#prettygcode-btn").click(function(){
        window.open('http://192.168.1.154:7136', '_blank');
      });
  });

  /*-- add addition php files below --*/

  $(document).ready(function() {
    $('#on').click(function(){  
    var a = new XMLHttpRequest();
    a.open("GET", "http://192.168.1.154:7990/on.php");
    a.onreadystatechange=function(){
         if(a.readyState==4){
        if(a.status==200){
        } else alert ("http error");
        }
    }
    a.send();
    });
  });

  $(document).ready(function(){ 
    $('#off').click(function(){
    var b = new XMLHttpRequest();
    b.open("GET", "http://192.168.1.154:7990/off.php");
    b.onreadystatechange=function(){
        if(b.readyState==4){
        if(b.status==200){
        } else alert ("http error");
        } 
    }
    b.send();
    });
  }); 


  $(document).ready(function(){
    $('#reset').click(function(){
    var c = new XMLHttpRequest();
    c.open("GET", "http://192.168.1.154:7990/reset.php");
    c.onreadystatechange=function(){
        if(c.readyState==4){
        if(c.status==200){
        } else alert ("http error");
        }
    }
    c.send();
    });
  });

  /* MQTT Commands to shut down the printer and boot up the printer using MQTT over websockets */

  /* Script to Turn printer ON: */
  /*
  The file printer-BOOT.htm uses MQTT Over WebSockets with Mosquitto (Javascript)
  Resources: https://www.eclipse.org/paho/files/jsdoc/Paho.MQTT.Client.html
           http://www.steves-internet-guide.com/mqtt-websockets/
           
  requirements:
  needs mosquitto installed on the raspberry pi
  need to install paho-mqtt via "pip3 install paho-mqtt"
  need to include [mqtt] section in moonraker and enable cors_domains: in moonraker

  # power on the PSU for the raspberry pi, this allows klipper to boot up
  Use MQTT over websockets to turn on the raspberry PI PSU
  # turn on the Stealthburner LEDs and WLED and White Case lights
  #RESETRGB_ONSTARTUP_0.8.cfg -> RESETRGB - runs automatically
  #PRERUN_1.cfg - runs automatically

  #turn on Raspberry_Pi_PSU via MQTT to tasmota firmware (POWER_ON_Pi_PSU)
  SUBSCRIBE: stat/Raspberry_Pi/Power
  PUBLISH: cmnd/Raspberry_Pi/Power 
    ON

  #_POWER_ON_ESP_PSU
  SUBSCRIBE: stat/ESP1_PSU/Power
  PUBLISH: cmnd/ESP1_PSU/Power
    ON
    
  # _POWER_ON_ESP2
  SUBSCRIBE: stat/ESP2_PSU/Power
  PUBLISH: cmnd/ESP2_PSU/Power 
    ON

  _POWER_ON_IR_PSU
  SUBSCRIBE: stat/IR_PSU/Power
  PUBLISH: cmnd/IR_PSU/Power 
    ON
    
  _POWER_ON_RGB_PSU
  SUBSCRIBE: stat/WLED1_15Amp_PSU/Power
  PUBLISH: cmnd/WLED1_15Amp_PSU/Power 
    ON
    
  _POWER_ON_RGB2  
  SUBSCRIBE: stat/WLED2_10Amp_PSU/Power
  PUBLISH: cmnd/WLED2_10Amp_PSU/Power 
    ON

  */
  $(document).ready(function(){
     $("#printer_on").click(function(){
       WARN.innerHTML='<h1> <span class="blck bold"> BOOTING the Printer</span><span class="bold">, ensure the</span> <span class="red bold yellow-background"> BIG RED Button</span><span class="bold"> has been manually </span><span class="red bold yellow-background">RELEASED!</span></h1>'
       WARN.style.display = 'block';
       //wait 10 secounds;
        setTimeout(function() {
          WARN.style.display = 'none';
        }, (10 * 1000));
        MQTTconnect_Raspberry_Pi_PSU2();
        ///wait 2 secounds;
        setTimeout(function() {
            MQTTconnect_ESP1_PSU();
        }, (2 * 1000));
        ///wait 3 secounds;
        setTimeout(function() {
            MQTTconnect_ESP2_PSU();
        }, (3 * 1000));
        ///wait 4 secounds;
        setTimeout(function() {
            MQTTconnect_IR_PSU();
        }, (4 * 1000));
        ///wait 5 secounds;
        setTimeout(function() {
            MQTTconnect_RGB_PSU();
        }, (5 * 1000));
        ///wait 6 secounds;
        setTimeout(function() {
            MQTTconnect_RGB2_PSU();
        }, (6 * 1000));
        ///wait 30 secounds;
        setTimeout(function() {
            mainsail_btn_Window = window.open('http://192.168.1.154:7991', '_blank');
        }, (30 * 1000)); 
      });
   });

  /* Script to Turn printer OFF:
  The file printer-SHUTDOWN.htm uses MQTT Over WebSockets with Mosquitto  (Javascript)
  Resources: https://www.eclipse.org/paho/files/jsdoc/Paho.MQTT.Client.html
           http://www.steves-internet-guide.com/mqtt-websockets/
           
  requirements:
  needs mosquitto installed on the raspberry pi
  need to install paho-mqtt via "pip3 install paho-mqtt"
  need to include [mqtt] section in moonraker and enable cors_domains: in moonraker

  #execute Klipper SHUTDOWN macro via MQTT!
  SUBSCRIBE: printer/ldo300kit/moonraker/api/response
  PUBLSIH: printer/ldo300kit/moonraker/api/request
  {
      "jsonrpc": "2.0",
      "method": "printer.gcode.script",
      "params": {
          "script": "SHUTDOWN"
      },
      "id": 507466}
    
  #turn off Raspberry_Pi_PSU via MQTT to tasmota firmware
  SUBSCRIBE: stat/Raspberry_Pi/Power
  PUBLISH: cmnd/Raspberry_Pi/Power 
    OFF
  */

  $(document).ready(function(){
     $("#printer_off").click(function(){
        WARN.innerHTML='<h1> <span class="red bold yellow-background">SHUTTING DOWN</span><span class="blck bold">, the Printer!</span> </h1>'
        WARN.style.display = 'block';
        //wait 2 secounds;
        setTimeout(function() {
          WARN.style.display = 'none';
          MQTTconnect_SHUTDOWN();
          if ((typeof mainsail_btn_Window !== "undefined") && (mainsail_btn_Window !== null))  
          {
             mainsail_btn_Window.close();
          }
          if ((typeof fluidd_btn_Window !== "undefined") && (fluidd_btn_Window !== null))  
          {
             fluidd_btn_Window.close(); 
          }
        }, (2 * 1000));
        //wait 32 secounds;
        setTimeout(function() {
            MQTTconnect_Raspberry_Pi_PSU();
            WARN.innerHTML='<h1> <span class="blck bold">After Printer has SHUTDOWN, ensure the </span><span class="red bold yellow-background">BIG RED Button</span><span class="bold"> has been manually </span><span class="red bold yellow-background">PRESSED IN!</span> </h1>'
            WARN.style.display = 'block';
            //wait 10 secounds;
            setTimeout(function() {
               WARN.style.display = 'none';
            }, (10 * 1000));
        }, (32 * 1000));
     });
  });

</script>


  <div data-role="page" data-theme="b">  
    <div data-role="header" data-theme="b">
      <div><h1 style="text-align:center">LDO 300 kit Control Page</h2></div>
    </div>
    <div data-role="header" data-theme="b">
      <div><h2>&nbsp;&nbsp;BOOT up or SHUTDOWN the LDO 300 kit's Klipper server (Raspberry Pi):</h2></div>
    </div>
    <div data-role="content" align="center">
      <br />
      <br />
      <form>
      <!-- This table contains the command buttons -->
        <table width="75%" style="background-color:#87adde">
          <tbody>
            <tr>
               <td><a href="#" data-role="button" data-icon="gear" id="printer_on"> TURN ON LDO 300 Kit Printer </a></td>
            </tr>
            <tr>
               <td><a href="#" data-role="button" data-icon="gear" id="printer_off"> Gracefully SHUTDOWN LDO 300 Kit Printer </a></td>
            </tr>
          </tbody>
        </table>
      </form> 
      <br>      
    </div>
    <div data-role="content" align="center">
      <div id="WARN" >
          <div><h1> this text will be displaced </h1></div>
       </div>
       <br />
    </div>
    <br />
    <div data-role="header" data-theme="b">
      <div><h2>&nbsp;&nbsp;Sonoff S31 - Raspberry Pi (sonoff_9):</h2></div>
    </div> 
    <div data-role="content" align="center">
      <iframe id="frame1" src="http://192.168.1.168" width=75% height=525></iframe>
    </div>
    <br />
    <div data-role="header" data-theme="b">
      <div><h2>&nbsp;&nbsp;GO TO Different Web Pages:</h2></div>
    </div>
    <div data-role="content" align="center">
      <br />
      <br />
      <form>
      <!-- This table contains the command buttons -->
        <table width="75%" style="background-color:#87adde">
           <tbody>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="mainssil-btn"> Go to LDO300kit's Mainsail UI </a></td>
              </tr>
              <tr>
                 <td><a href="#" data-role="button" data-icon="gear" id="fluidd-btn"> Go to LDO300kit's Fluidd UI </a></td>
              </tr>
              <tr>
                 <td><a href="#" data-role="button" data-icon="gear" id="prettygcode-btn"> Go to PrettyGCode for Klipper UI </a></td>
              </tr>
              <tr>
                 <td><a href="#" data-role="button" data-icon="gear" id="moontest-btn"> Moonraker POST example on Printer's Pi UI </a></td>
              </tr>
           </tbody>
        </table>
      </form>
      <br />
      <br />
      <br />   
    </div>
    <div data-role="header" data-theme="b">
      <div><h2>&nbsp;&nbsp;GO TO Different Klipper Configuration Resource Web Pages:</h2></div>
    </div>
    <div data-role="content" align="center">
      <br />
      <br />
      <form>
      <!-- This table contains the command buttons -->
        <table width="75%" style="background-color:#87adde">
           <tbody>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="klipper-docs-btn"> Klipper Documentation </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="reprap-g-code-docs-btn"> RepRap G-Code Documentation </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="vorondesign-forum-btn"> VoronDesign Forum </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="vorondesign-mods-btn"> VoronDesign MODS </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="voron-printer-database-btn"> Voron Printer Database </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="template-engine-btn"> JINJA2 Template Engine </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="math-functions-btn"> JINJA2 string concatination and Math functions </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="string-formatting-btn"> Modulo String Formatting in Python </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="basic-syntax-btn"> Basic Syntax of Jinja </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="command-templates-btn"> Klipper's Commands templates </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="print-tuning-guide-btn"> AndrewEllis93 Voron Print Tuning Guide </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="jschuh-btn"> jschuh Klipper Macros </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="generic-klipper-config-btn"> Frix-x Generic Klipper Configuration </a></td>
              </tr>
            </tbody>
        </table>
      </form>
      <br />
      <br />
      <br />
    </div>
    <div data-role="header" data-theme="b">
      <div><h2>&nbsp;&nbsp;Other klipper backups I've found useful:</h2></div>
    </div>
    <div data-role="content" align="center">
      <br />
      <br />
      <form>
      <!-- This table contains the command buttons -->
        <table width="75%" style="background-color:#87adde">
          <tbody>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="AndrewEllis93-btn"> AndrewEllis93 Klipper Config Backup </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="pushc6-btn"> pushc6 VoronConfig Backup </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="3dp-voron2-btn"> kageurufu 3dp Voron2 Backup </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="wile-e1-btn"> wile-e1 Klipper Config Backup </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="th33xitus-btn"> th33xitus Klipper Config Backup </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="jktightwad-btn"> jktightwad Klipper Config Backup </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="mjoconr-btn"> mjoconr Voron2.4 Config Backup </a></td>
              </tr>
              <tr>
                <td><a href="#" data-role="button" data-icon="gear" id="zellneralex-btn"> zellneralex Klipper Config Backup </a></td>
              </tr>
          </tbody>
        </table>
      </form>
      <br />
      <br />
      <br /> 
    </div>      
    <div data-role="header" data-theme="b">
       <div><h2>&nbsp;&nbsp;Sonoff S31 - ESP1 PSU (sonoff_3):</h2></div>
    </div> 
    <div data-role="content" align="center">
      <iframe id="frame2" src="http://192.168.1.149" width=75% height=525></iframe>
    </div>
    <br />
    <div data-role="header" data-theme="b">
      <div><h2>&nbsp;&nbsp;Sonoff S31 - ESP2 PSU (sonoff_4):</h2></div>
    </div> 
    <div data-role="content" align="center">
      <iframe id="frame3" src="http://192.168.1.150/" width=75% height=525></iframe>
    </div>
    <br />
    <div data-role="header" data-theme="b">
      <div><h2>&nbsp;&nbsp;Sonoff S31 - IR_PSU (sonoff_5):</h2></div>
    </div> 
    <div data-role="content" align="center">
      <iframe id="frame4" src="http://192.168.1.151/" width=75% height=525></iframe>
    </div>
    <br />
    <div data-role="header" data-theme="b">
      <div><h2>&nbsp;&nbsp;Sonoff S31 - WLED1 15Amp PSU (sonoff_7):</h2></div>
    </div> 
    <div data-role="content" align="center">
      <iframe id="frame5" src="http://192.168.1.166/" width=75% height=525></iframe>
    </div>
    <br />
    <div data-role="header" data-theme="b">
      <div><h2>&nbsp;&nbsp;Sonoff S31 - WLED2 10Amp PSU (sonoff_8):</h2></div>
    </div> 
    <div data-role="content" align="center">
      <iframe id="frame6" src="http://192.168.1.167/" width=75% height=525></iframe>
    </div>
    <br />
    <div data-role="header" data-theme="b">
      <div><h2>&nbsp;&nbsp;WLED1 for Chamber Lights:</h2></div>
    </div> 
    <div data-role="content" align="center">
      <iframe id="frame7" src="http://192.168.1.160/" width=100% height=1000></iframe>
    </div>
    <br />
    <div data-role="header" data-theme="b">
      <div><h2>&nbsp;&nbsp;WLED2 for:: Electronic Case, Bed Wire Cover:</h2></div>
    </div> 
    <div data-role="content" align="center">
      <iframe id="frame8" src="http://192.168.1.161/" width=100% height=1000></iframe>
    </div>
    <br />
    <div data-role="header" data-theme="b">
      <div><h2>&nbsp;&nbsp;Manually RESET RP2040 Chip on TinyFAN PCB:</h2></div>
    </div>
    <div data-role="content" align="center">
      <form>
      <!-- This table contains the command buttons -->
        <table width="75%" style="background-color:#87adde">
          <tbody>
           <tr>
             <td><a href="#" data-role="button" data-icon="gear" id="reset"> RESET RP2040 Chip </a></td>
           </tr>
           <tr>
               <td><a href="#" data-role="button" data-icon="arrow-d" id="off"> RP2040 USB Port OFF </a></td>
           </tr>
           <tr>
               <td><a href="#" data-role="button" data-icon="arrow-u" id="on"> RP2040 USB Port ON </a></td>
           </tr>
          </tbody>
        </table>
      </form>
      <br />
      <br />
      <br />
    </div>
    <br />
    <div data-role="header" data-theme="b">
      <div><h2>&nbsp;&nbsp;Sonoff S31 - Mosquitto PSU (sonoff_6):</h2></div>
    </div> 
    <div data-role="content" align="center">
      <iframe id="frame9" src="http://192.168.1.152" width=75% height=525></iframe>
    </div>
    <br />
  </div>
</body>
</html>
